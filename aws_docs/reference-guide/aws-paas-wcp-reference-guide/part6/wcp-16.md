# WCP16-Deferred Choice(延迟选择) | AWS 流程引擎对WCP的支持评估

## WCP16-Deferred Choice(延迟选择)

延迟选择是指在流程中，某个点连接多个分支，这些分支的选择基于和操作环境的交互。所有分支代表了未来执行可能出现的情况。分支选择由分支上第一个开始执行的任务决定，即分支的决策没有明确的选择，由分支竞争决定。做出选择后，其他分支被撤销。

  * 在同一流程实例中，网关连接多个分支。在运行中，根据操作环境的交互，选择其中一个分支执行，其他分支则被忽略。
  * 例如客户选择上门安装服务后，工人A和工人B谁去执行，取决于谁先看到此订单。

## 解决方案

### 场景设计

  * “节点1”任务完成后，事件网关要选择先被触发的分支
  * 如果“捕获信号事件”先捕获到信号，则分支1被选中，分支2被撤销
  * 反之，如果“捕获时间事件”先被触发，则分支2被选中，分支1被撤销

### 流程建模

![](https://docs.awspaas.com/reference-guide/aws-paas-wcp-reference-guide/part6/wcp16-process-model.png)

> 可以在`工作流控制模式概念验证`应用的`流程模型>6.State-based Patterns(状态模式)>WCP16-Deferred Choice(延迟选择)`中访问该流程模型

### 引擎执行

  * 确认已安装`工作流控制模式概念验证`应用，访问前端`WCP概念验证`菜单入口
  * 在左侧树中点击`WCP16-Deferred Choice(延迟选择)`项
  * 在列表中点击`新建`按钮，流程实例被创建
  * 此时，“节点1”已创建一个任务实例
  * 在任务列表中打开“节点1”任务实例，点击`办理`按钮，完成任务，此时“节点4”创建一个任务实例，并且流程实例到达事件网关
  * 如果“节点4”先办理完成，“节点2”先接收到消息，则“节点2”创建一个任务实例，同时分支2被撤销。在任务列表中打开“节点2”任务实例，点击`办理`按钮，完成任务，“节点5”创建一个任务实例
  * 如果到达“捕获时间事件”中设置的时间，则“节点3”创建一个任务实例，同时分支1被撤销。在任务列表中打开“节点3”任务实例，点击`办理`按钮，完成任务。再打开“节点4”任务实例，点击`办理`按钮，完成任务。此时，“节点5”创建一个任务实例 -在任务列表中打开“节点5”任务实例，点击`办理`按钮，完成任务，流程结束。

> 如果列表中未出现`新建`按钮，请首先为此用户设置可启动该流程的权限