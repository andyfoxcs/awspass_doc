# WCP39-Critical Section(独占) | AWS 流程引擎对WCP的支持评估

## WCP39-Critical Section(独占)

一个流程实例中的两个或者两个以上的连通子图被确定为“临界区”。在一个给定的流程实例运行时，只有这些“临界区”中的任务在任何给定的时间是活动的。一旦执行的任务在一个“临界区”开始，在另一个“临界区”开始之前，它就必须完成。

  * 在同一流程实例中，设置一组临界值，当某一临界区中的任务被执行时，其他临界区的任务不能执行。图中的实例是指，当E或G执行时，不允许B中的token进入临界区进行任务的执行。
  * 保险支付和存款任务都要用信用卡专用机器时，其中一项执行时，另一项只能等待。

## 解决方案

### 场景设计

  * 并行执行“节点1”和“节点2”的任务
  * 如果“节点1”任务先执行，则先执行“脚本任务1”任务，挂起“节点2”任务。执行“节点3”任务，“节点3”任务完成后，执行“脚本任务3”任务，激活“节点2”任务，执行“节点2”任务，“节点2”任务完成后，执行“脚本任务2”任务，当“脚本任务2”任务完成后执行“节点4”任务，当“节点4”任务完成后，执行“脚本任务4”任务，当“脚本任务4”任务完成后，流程结束
  * 如果“节点2”任务先执行，则先执行“脚本任务2”任务，挂起“节点1”任务。执行“节点4”任务，“节点4”任务完成后，执行“脚本任务4”任务，激活“节点1”任务，执行“节点1”任务，“节点1”任务完成后，执行“脚本任务1”任务，当“脚本任务1”任务完成后执行“节点3”任务，当“节点3”任务完成后，执行“脚本任务3”任务，当“脚本任务3”任务完成后，流程结束

### 流程建模

![](https://docs.awspaas.com/reference-guide/aws-paas-wcp-reference-guide/part6/wcp39-process-model.png)

> 可以在`工作流控制模式概念验证`应用的`流程模型>6.State-based Patterns(状态模式)>WCP39-Critical Section(独占)`中访问该流程模型

### 引擎执行

  * 确认已安装`工作流控制模式概念验证`应用，访问前端`WCP概念验证`菜单入口
  * 在左侧树中点击`WCP39-Critical Section(独占)`项
  * 在列表中点击`新建`按钮，流程实例被创建
  * 此时，“节点1”和“节点2”已创建一个任务实例
  * 如果选择先执行“节点1”任务。在任务列表中打开“节点1”任务实例，点击`办理`按钮，完成任务，执行“脚本任务1”任务，挂起“节点2”任务实例。此时“节点3”创建一个任务实例，在任务列表中打开“节点3”任务实例，点击`办理`按钮，完成任务，“节点3”任务完成后，执行“脚本任务3”任务，激活被挂起的“节点2”任务实例。在任务列表中打开“节点2”任务实例，点击`办理`按钮，完成任务，“节点2”任务完成后，执行“脚本任务2”任务，当“脚本任务2”完成后，“节点4”创建一个任务实例，在任务列表中打开“节点4”任务实例，点击`办理`按钮，完成实例，当“节点4”任务完成后，执行“脚本任务4”任务，当“脚本任务4”任务完成后，流程结束
  * 如果选择先执行“节点2”任务。在任务列表中打开“节点2”任务实例，点击`办理`按钮，完成任务，执行“脚本任务2”任务，挂起“节点1”任务实例。此时“节点4”创建一个任务实例，在任务列表中打开“节点4”任务实例，点击`办理`按钮，完成任务，“节点4”任务完成后，执行“脚本任务4”任务，激活被挂起的“节点1”任务实例。在任务列表中打开“节点1”任务实例，点击`办理`按钮，完成任务，“节点1”任务完成后，执行“脚本任务1”任务，当“脚本任务1”完成后，“节点3”创建一个任务实例，在任务列表中打开“节点3”任务实例，点击`办理`按钮，完成实例，当“节点3”任务完成后，执行“脚本任务3”任务，当“脚本任务3”任务完成后，流程结束

> 如果列表中未出现`新建`按钮，请首先为此用户设置可启动该流程的权限