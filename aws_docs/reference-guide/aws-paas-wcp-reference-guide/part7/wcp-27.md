# WCP27-Complete Multiple Instance Activity(完成多例) | AWS 流程引擎对WCP的支持评估

## WCP27-Complete Multiple Instance Activity(完成多例)

在一个给定的流程实例中，可以为一个任务创建多个实例。所需实例的数量在设计时是已知的。这些实例是相互独立，并且同时运行的。在触发后续任务之前，必须同步完成实例。在执行过程中，任务可能需要被强制完成，使得任何剩余的实例被撤回，并将控制线程传递给后续任务。

  * 给定一个流程实例，创建一个任务多实例。实例是并发独立的。实例在完成时必须被同步。在执行的过程中，这个任务可能需要被强制完成。
  * 例如在检测500份蛋白质样品，开始一小时后，撤回所有剩余实例，并启动下一任务。

## 解决方案

### 场景设计

  * “节点2”任务是一个多实例任务
  * 在“捕获时间事件”设置的时间内，“节点1”和“节点2”所有实例完成后，等待“脚本任务”任务完成后，执行“节点3”任务，当“节点3”任务完成后，流程结束
  * 在“节点2”任务还没有完成是，“捕获时间事件”设置的时间到达，执行“脚本任务”任务，完成“节点2”的所有任务实例，执行“节点3”任务，当“节点3”任务完成后，流程结束

### 流程建模

![](https://docs.awspaas.com/reference-guide/aws-paas-wcp-reference-guide/part7/wcp27-process-model.png)

> 可以在`工作流控制模式概念验证`应用的`流程模型>7.Cancellation and Force Completion Patterns(取消模式)>WCP27-Complete Multiple Instance Activity(完成多例)`中访问该流程模型

### 引擎执行

  * 确认已安装`工作流控制模式概念验证`应用，访问前端`WCP概念验证`菜单入口
  * 在左侧树中点击`WCP27-Complete Multiple Instance Activity(完成多例)`项
  * 在列表中点击`新建`按钮，流程实例被创建
  * 此时，“节点1”已经创建一个任务实例，同时触发“捕获时间事件”
  * 在任务列表中打开“节点1”任务实例，点击`办理`按钮，完成任务，指定“节点2”任务的参与者
  * 此时“节点2”创建多个任务实例
  * 在“捕获时间事件”设置的时间未到达时，在任务列表中打开“节点2”任务实例，点击`办理`按钮，完成任务，等待“脚本任务”任务执行完后，“节点3”创建一个任务，在任务列表打开“节点3”任务实例，点击`办理`按钮，完成任务，流程结束
  * 在“捕获时间事件”设置的时间未到达是，如果“节点2”创建的多个任务实例还有未完成的，执行“脚本任务”任务，完成“节点2”任务未完成的任务实例，执行“节点3”任务，此时“节点3”创建一个任务实例，在任务列表打开“节点3”任务实例，点击`办理`按钮，完成任务，流程结束

> 如果列表中未出现`新建`按钮，请首先为此用户设置可启动该流程的权限